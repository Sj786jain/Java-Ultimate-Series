<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Employee Directory</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="container py-4">
<h1 class="mb-4">Employee Directory</h1>

<!-- Add Employee Form -->
<div class="card mb-4">
    <div class="card-header">Add New Employee</div>
    <div class="card-body">
        <form id="employeeForm" class="row g-3">
            <div class="col-md-6">
                <input class="form-control" type="text" id="firstName" placeholder="First Name" required>
            </div>
            <div class="col-md-6">
                <input class="form-control" type="text" id="lastName" placeholder="Last Name" required>
            </div>
            <div class="col-md-6">
                <input class="form-control" type="email" id="email" placeholder="Email" required>
            </div>
            <div class="col-md-6">
                <input class="form-control" type="text" id="department" placeholder="Department">
            </div>
            <div class="col-md-6">
                <input class="form-control" type="text" id="position" placeholder="Position">
            </div>
            <div class="col-md-6">
                <input class="form-control" type="number" id="salary" placeholder="Salary">
            </div>
            <div class="col-12">
                <button class="btn btn-primary" type="submit">Add Employee</button>
            </div>
        </form>
    </div>
</div>

<!-- Search Bar -->
<div class="mb-3">
    <input type="text" id="searchInput" class="form-control" placeholder="Search by name">
</div>

<!-- Employee Table -->
<table class="table table-bordered" id="empTable">
    <thead class="table-dark">
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Department</th>
        <th>Position</th>
        <th>Salary</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<!-- Pagination Controls -->
<div class="d-flex justify-content-between">
    <button class="btn btn-secondary" onclick="prevPage()">Previous</button>
    <button class="btn btn-secondary" onclick="nextPage()">Next</button>
</div>

<script>
    let currentPage = 0;
    let pageSize = 5;
    let currentSearch = "";

    document.getElementById("employeeForm").addEventListener("submit", e => {
      e.preventDefault();
      addEmployee();
    });

    document.getElementById("searchInput").addEventListener("input", e => {
      currentSearch = e.target.value;
      currentPage = 0;
      loadEmployees();
    });

    function addEmployee() {
      const data = {
        firstName: document.getElementById("firstName").value,
        lastName: document.getElementById("lastName").value,
        email: document.getElementById("email").value,
        department: document.getElementById("department").value,
        position: document.getElementById("position").value,
        salary: document.getElementById("salary").value
      };
      fetch('/api/employees', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
        .then(res => {
          if (!res.ok) throw new Error("Failed to add employee");
          return res.json();
        })
        .then(() => {
          document.getElementById("employeeForm").reset();
          loadEmployees();
        })
        .catch(err => alert(err.message));
    }

    function deleteEmployee(id) {
      if (confirm("Are you sure you want to delete this employee?")) {
        fetch('/api/employees/' + id, { method: 'DELETE' })
          .then(res => {
            if (!res.ok) throw new Error("Failed to delete employee");
            loadEmployees();
          })
          .catch(err => alert(err.message));
      }
    }

    function loadEmployees() {
      fetch(`/api/employees?page=${currentPage}&size=${pageSize}&name=${currentSearch}`)
        .then(res => res.json())
        .then(data => {
          let tbody = document.querySelector('#empTable tbody');
          tbody.innerHTML = '';
          data.content.forEach(emp => {
            let row = `<tr>
              <td>${emp.id}</td>
              <td>${emp.fullName}</td>
              <td>${emp.email}</td>
              <td>${emp.department}</td>
              <td>${emp.position}</td>
              <td>${emp.salary}</td>
              <td><button class='btn btn-danger btn-sm' onclick='deleteEmployee(${emp.id})'>Delete</button></td>
            </tr>`;
            tbody.innerHTML += row;
          });
        });
    }

    function nextPage() {
      currentPage++;
      loadEmployees();
    }

    function prevPage() {
      if (currentPage > 0) {
        currentPage--;
        loadEmployees();
      }
    }

    // Initial load
    loadEmployees();
</script>
</body>
</html>

